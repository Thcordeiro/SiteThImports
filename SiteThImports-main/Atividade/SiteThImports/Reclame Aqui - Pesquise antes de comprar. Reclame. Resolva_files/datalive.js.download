var EventAction,DL=function(){function e(e){this.idClient=0,this.socketDomain="wss://socket-node.staging.datalive.ai/ws/",this.apiDomain="https://template-service.datalive.ai/api/template",this.cssDomain="https://data.datalivemarketing.com.br/staging/templates/",this.crossDomain="https://data.datalivemarketing.com.br/staging/crossdomain/v7/crossdomain.html",this.elementIframe=null,this.idClient=e}return e.prototype.initCross=function(){console.log("Init Datalive Complete"),console.log("Init Cross"),this.cross()},e.prototype.initJS=function(){console.log("Init JS"),this.js()},e.prototype.js=function(){Datalive.connect(this.socketDomain,this.apiDomain)},e.prototype.cross=function(){var t=this,n=null,o=!1,a="DL_ID";e.BeforeInfrastructure()&&(localStorage.setItem("DL_ID",e.GetClientId()),a="DL_ID2"),window.onmessage=function(i){switch(i.data.key){case"INIT":if(""!=i.data.data)localStorage.setItem(a,i.data.data);else if(null!=localStorage.getItem(a)&&""!=localStorage.getItem(a))t.elementIframe&&t.elementIframe.contentWindow.postMessage({method:"SET",data:localStorage.getItem(a)},"*");else{var r=t.createDlID(a);localStorage.setItem(a,r),t.elementIframe&&t.elementIframe.contentWindow.postMessage({method:"SET",data:r},"*")}dataLayer.push({event:"DL_CREATE_SUCCESS","data.DL_CREATE_SUCCESS":!0}),t.initJS(),o=!0,n&&clearTimeout(n);break;case"BEFORE_INFRASTRUCTURE":localStorage.setItem("DL_ID",e.GetClientId())}},this.createIframe(),n=setTimeout(function(){if(0==o){if(null!=localStorage.getItem(a)&&""!=localStorage.getItem(a)){var e=t.createDlID(a);localStorage.setItem(a,e)}dataLayer.push({event:"DL_CREATE_SUCCESS","data.DL_CREATE_SUCCESS":!0}),t.initJS()}},3e3)},e.prototype.createIframe=function(){this.elementIframe=document.createElement("iframe"),this.elementIframe.id="datalive",this.elementIframe.style.display="none",this.elementIframe.src=this.crossDomain,document.body.append(this.elementIframe)},e.prototype.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},e.prototype.createDlID=function(e){return null!=localStorage.getItem(e)?localStorage.getItem(e):this.uuid()},e.BeforeInfrastructure=function(){return null!=localStorage.getItem("dl_id")},e.GetClientId=function(){try{var e=document.cookie.substr(document.cookie.search("_ga=GA"));return e.substr(10,e.search(";")-10)}catch(e){return"false"}},e}(),DLEvent=function(){function e(){}return e.sendEvent=function(e,t,n){if(void 0===n&&(n=5e3),this.VerifyNonConsent()){var o=this.pixelDomain+e+"?t=event";o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=o+"&dl="+encodeURIComponent(t.URL))+"&dt="+encodeURIComponent(t.DL_DLV_ATTRIBUTES_PAGETITLE))+"&cid="+(t.DL_DL_ID||t.DL_JS_CLIENTID))+"&vp="+encodeURIComponent(t.DL_JS_VIEWPORT))+"&sr="+encodeURIComponent(t.Resolution))+"&ec="+encodeURIComponent(t.eventCategory))+"&ni="+encodeURIComponent(t.nonInteraction))+"&ea="+encodeURIComponent(t.eventAction))+"&el="+encodeURIComponent(t.eventLabel))+"&ev="+encodeURIComponent(t.eventValue))+"&cd1="+encodeURIComponent(t.DL_JS_CLIENTID||t.DL_DL_ID))+"&cd2="+encodeURIComponent(t.DL_JS_SESSIONID))+"&cd3="+encodeURIComponent(t.DL_JS_TIMESTAMP),o=this.addVars(o,t);var a=document.createElement("img");a.src=o,setTimeout(function(e){if(!a.complete||!a.naturalWidth){a.src="https://data.datalivemarketing.com.br/pixel.png"}},n)}},e.sendPageview=function(e,t,n){if(void 0===n&&(n=5e3),this.VerifyNonConsent()){var o=this.pixelDomain+e+"?t=pageview";o=(o=(o=(o=(o=(o=(o=(o=(o=o+"&dl="+encodeURIComponent(t.URL))+"&dr="+encodeURIComponent(t.Referrer))+"&sr="+encodeURIComponent(t.Resolution))+"&vp="+encodeURIComponent(t.DL_JS_VIEWPORT))+"&dt="+encodeURIComponent(t.DL_DLV_ATTRIBUTES_PAGETITLE))+"&cid="+(t.DL_DL_ID||t.DL_JS_CLIENTID))+"&cd1="+encodeURIComponent(t.DL_JS_CLIENTID||t.DL_DL_ID))+"&cd2="+encodeURIComponent(t.DL_JS_SESSIONID))+"&cd3="+encodeURIComponent(t.DL_JS_TIMESTAMP),o=this.addVars(o,t);var a=document.createElement("img");a.src=o,setTimeout(function(){if(!a.complete||!a.naturalWidth){a.src="https://data.datalivemarketing.com.br/pixel.png"}},n)}},e.sendUser=function(e,t,n){if(void 0===n&&(n=5e3),this.VerifyNonConsent()){var o=this.pixelDomain+e+"?t=user";o=(o=(o=(o=(o=(o=o+"&dlid="+t.DL_DL_ID)+"&cid="+t.DL_JS_CLIENTID)+"&uid="+t.DL_JS_USERID)+"&emid="+t.DL_EMAIL_ID)+"&em="+t.DL_EMAIL)+"&p="+encodeURIComponent(window.location.href),o=this.addVars(o,t);var a=document.createElement("img");a.src=o,setTimeout(function(){if(!a.complete||!a.naturalWidth){a.src="https://data.datalivemarketing.com.br/pixel.png"}},n)}},e.addVars=function(e,t){for(var n=0,o=Object.keys(t);n<o.length;n++){var a=o[n];new RegExp(/(cd|cm)(((1|2)([0-9])*)|([1-9]))/,"gi").test(a)&&(e="".concat(e,"&").concat(a,"=").concat(encodeURIComponent(t[a])))}return e},e.VerifyNonConsent=function(){try{var e=window.localStorage.getItem("DL_NonConsentStatus");return null==e||"blocked"!==e}catch(e){return!0}},e.pixelDomain="https://pixel.staging.datalivemarketing.com.br/api/pixel/",e}(),PageModel=function(){return function(){}}(),UserModel=function(){return function(){}}(),EventModel=function(){return function(){}}(),Datalive=function(){function e(){}return e.connect=function(e,t){Controls.DL_ID=localStorage.getItem("DL_ID"),Controls.setSocketUrl(e),Controls.setAPIUrl(t),this.dlSocket=new Socket(e,this.attempts),Controls.setTimePageview(),Controls.removeOpen(),Controls.removeQuarentine(),new EasterEggDL(Controls.DL_ID),window.dlversion=function(){console.log("@Version@")}},e.form=function(e){this.dlSocket?this.dlSocket.sendMessage(JSON.stringify(e),"FORM"):(console.warn("Não tem conexão com o socket ativa."),console.warn("Reconectando..."),this.dlSocket=new Socket(Controls.getSocketUrl(),this.attempts),this.dlSocket.sendMessage(JSON.stringify(e),"FORM"))},e.captureDatalayer=function(){"object"==typeof window.dataLayer&&"function"==typeof window.dataLayer.push?window.dataLayer.push=function(e){window.dataLayer=window.dataLayer.concat([e]),console.log("Datalive  pushed!")}:(window.dataLayer=[],window.dataLayer.push=function(e){window.dataLayer=window.dataLayer.concat([e]),console.log("Datalive  pushed!")})},e.attempts=3,e}(),CustomPopup=function(){function e(){}return e.customShow={aVal:!1,aPopup:{},aListener:function(e){},registerListener:function(e,t){this.aPopup=e,this.aListener=t},setValue:function(e){this.aVal=e,this.aListener(this.aPopup,this.aVal)},getValue:function(){return this.aVal}},e}(),Datalayer=function(){return function(e){void 0!==e.Variable&&EventsDataLayer.event(e.Variable.Action,e.Variable.Category,e.Variable.Label,e.Variable.Value)}}(),NonConsent=function(){return function(e){"blocked"==e.Status?localStorage.setItem("DL_NonConsentStatus",e.Status):localStorage.removeItem("DL_NonConsentStatus")}}(),Popup=function(){function e(e){var t=this;this.timerTitle=null,this.titleWindow="",this.render=function(){TemplateControl.get(t.getTemplate(),function(e){var n=new Interpolation(t.response).convert(e);if(t.element=document.createElement("dl-template"),t.element.innerHTML=n,document.body.appendChild(t.element),t.response.Variable.TitlePage){t.titleWindow=document.title;var o=!1;document.title=t.response.Variable.TitlePage,t.timerTitle=setInterval(function(){o?(document.title=t.response.Variable.TitlePage,o=!1):(document.title=t.titleWindow,o=!0)},1e3)}t.events()})},this.response=e,this.socketEvents=new SocketEvents,this.socketEvents.eventCategory=TranslateEvents.type(this.response.Type),this.socketEvents.eventLabel="".concat(this.getTemplate()),this.socketEvents.eventValue=this.response.IdCampaign;var n=new Interpolation(this.response);switch(this.socketEvents.personalizacao=n.getPersonalizacao(),e.IdTrigger){case 1:this.exit();break;case 2:this.time();break;case 3:this.socketEvents.eventValue=e.IdTrigger,this.agree();break;case 4:this.custom()}}return e.prototype.exit=function(){var e=this;document.addEventListener("mouseout",function(t){Controls.getOpen()||Controls.getSessionExit()||(t.clientY<0||t.clientX>window.innerWidth||t.clientX<0||t.clientY>window.innerHeight)&&(Controls.setSessionExit(),e.show())},!1)},e.prototype.time=function(){var e=this,t=Controls.TIME_PAGEVIEW+this.response.Param.MinTime,n=(new Date).getTime();t<n?this.show():setTimeout(function(){e.show()},t-n)},e.prototype.agree=function(){Controls.getAgree()||this.render()},e.prototype.custom=function(){dl_custom_show=CustomPopup.customShow,dl_custom_show.registerListener(this,function(e,t){t&&e.show()});var e="<script>"+this.response.CustomJsTrigger+"<\/script>",t=document.createRange();t.selectNode(document.getElementsByTagName("BODY")[0]);var n=t.createContextualFragment(e);document.body.appendChild(n)},e.prototype.getTemplate=function(){var e=this.response.IdTemplate;for(var t in this.response.Variable)"IdTemplate"==t&&(e=this.response.Variable[t]);return e},e.prototype.events=function(){var t=this.element.querySelectorAll(".dl-agree");t.length>0&&t[0].addEventListener("click",this.agreeEvent.bind(this));var n=this.element.querySelectorAll(".dl-close");n.length>0&&n[0].addEventListener("click",this.close.bind(this));var o=document.querySelectorAll("[data-type='form']");o.length>0&&o[0].addEventListener("submit",this.submit.bind(this));var a=document.querySelectorAll("[data-type='link']");if(a.length>0)for(var i=0;i<a.length;i++)a[i].addEventListener("click",this.link.bind(this,i));var r=document.querySelectorAll("[data-type='confirm'] button");r.length>0&&r[0].addEventListener("click",this.confirm.bind(this));var s=document.querySelectorAll("[data-type='form'] [mask]");s.length>0&&e.setMask(s)},e.setMask=function(e){for(var t=new Mask,n=0;n<e.length;n++)switch(e[n].attributes.mask.value){case"tel":t.addEventTel(e[n])}},e.prototype.show=function(){Controls.getOpen()||(Controls.setOpen(),this.render(),this.setEvents(EventAction.SHOW),Controls.setQuarentine(this.response.Param.Quarentine))},e.prototype.agreeEvent=function(){this.element.remove(),this.setEvents(EventAction.CLOSED),Controls.setAgree()},e.prototype.close=function(e){void 0===e&&(e=!0),Controls.removeOpen(),this.element.remove(),this.timerTitle&&(clearInterval(this.timerTitle),this.timerTitle=null,""!==this.titleWindow&&(document.title=this.titleWindow)),e&&this.setEvents(EventAction.CLOSED),3==this.response.IdTrigger&&Controls.setAgree()},e.prototype.submit=function(){for(var e=document.querySelectorAll("[data-type='form']")[0],t={},n=0;n<e.elements.length;n++){var o=e.elements[n];if("INPUT"==o.nodeName&&(t[o.name]=o.value),"hidden"!=o.type&&"none"!=o.style.display){if(""==t[o.name])return void(o.className+=" dl-error");o.className.replace(" dl-error","")}}this.setEvents(EventAction.CONVERTED),t.URI=e.attributes["data-action"].value,Datalive.form(t),this.close(!1),this.getChildren()},e.prototype.getChildren=function(){var e=this;TemplateControl.getChild(this.getTemplate(),function(t){TemplateControl.get(t,function(t){e.element=document.createElement("dl-template"),e.element.innerHTML=t,document.body.appendChild(e.element),e.events()})})},e.prototype.link=function(e){var t=this;this.setEvents(EventAction.CONVERTED),setTimeout(function(){var n=document.querySelectorAll("[data-type='link']")[e];try{if(n.attributes["data-target"]&&"_blank"===n.attributes["data-target"].value){var o=document.createElement("a");return o.setAttribute("href",n.attributes["data-action"].value),o.setAttribute("target","_blank"),o.click(),void t.close(!1)}location.href=n.attributes["data-action"].value,t.close(!1)}catch(o){location.href=n.attributes["data-action"].value,t.close(!1)}},500)},e.prototype.confirm=function(){this.close(!1)},e.prototype.setEvents=function(e){this.socketEvents.eventAction=TranslateEvents.action(e),dataLayer.push({event:"DL_EVENT_SOCKET",data:this.socketEvents})},e}(),Recommendation=function(){function e(t){if(DLEvent.VerifyNonConsent()){if(this.SocketEventsSend(t,EventAction.RECEIVED),null!=t.Param.BlackList){if(e.blackList(t.Param.BlackList)){if(null==t.Param.WhiteList)return void this.SocketEventsSend(t,EventAction.BLOCKED_BY_BLACKLIST);if(e.whiteList(t.Param.WhiteList))return void this.SocketEventsSend(t,EventAction.BLOCKED_BY_WHITELIST)}}else if(null!=t.Param.WhiteList&&e.whiteList(t.Param.WhiteList))return void this.SocketEventsSend(t,EventAction.BLOCKED_BY_WHITELIST);if(Controls.getQuarentine())return void this.SocketEventsSend(t,EventAction.QUARENTENA);var n=void 0,o="".concat(t.IdCampaign);try{var a=0;if(void 0!==t.Variable.ControlCampaign&&"object"!=typeof t.Variable.ControlCampaign)a=parseFloat(t.Variable.ControlCampaign.replace(",","."))/100;else if("object"==typeof t.Variable.ControlCampaign){var i=t.Variable.ControlCampaign;a=parseFloat(i.data[i.active].value.replace(",","."))/100,o=i.active}var r=localStorage.getItem("DL_CONTROL_GROUP_".concat(o));a>0&&!r?(n=Math.random()<=a,localStorage.setItem("DL_CONTROL_GROUP_".concat(o),n?"1":"0")):n="1"===r}catch(e){t.Variable.error=JSON.stringify(e),this.SocketEventsSend(t,EventAction.ERROR),n=!1}if(n){var s=new SocketEvents;s.eventCategory=TranslateEvents.type(t.Type),s.eventLabel="".concat(t.IdTemplate),s.eventValue=t.IdCampaign,s.eventAction=TranslateEvents.action(EventAction.CONTROL_CAMPAIGN);var c=new Interpolation(t);s.personalizacao=c.getPersonalizacao({IdControlGroup:o}),dataLayer.push({event:"DL_EVENT_SOCKET",data:s}),Controls.setQuarentine(t.Param.Quarentine)}else switch(t.Type){case 1:new Popup(t);break;case 2:new Datalayer(t)}}}return e.prototype.SocketEventsSend=function(e,t){var n=new SocketEvents;n.eventCategory=TranslateEvents.type(e.Type),n.eventLabel="".concat(this.getTemplate(e)),n.eventValue=e.IdCampaign,n.eventAction=TranslateEvents.action(t);var o=new Interpolation(e);n.personalizacao=o.getPersonalizacao(),dataLayer.push({event:"DL_EVENT_SOCKET",data:n})},e.prototype.getTemplate=function(e){var t=e.IdTemplate;for(var n in e.Variable)"IdTemplate"==n&&(t=e.Variable[n]);return t},e.blackList=function(e){for(var t=0;t<e.length;t++)if(""!=e[t])if(e[t].startsWith("match:")){if(null!="".concat(location.host).concat(location.pathname).match(e[t].replace("match:","")))return!0}else if(-1!="".concat(location.host).concat(location.pathname).indexOf(e[t]))return!0;return!1},e.whiteList=function(e){for(var t=0;t<e.length;t++)if(""!=e[t])if(e[t].startsWith("match:")){if(null!="".concat(location.host).concat(location.pathname).match(e[t].replace("match:","")))return!1}else if(-1!="".concat(location.host).concat(location.pathname).indexOf(e[t]))return!1;return!0},e}(),EasterEggDL=function(){function e(e){this.dataliveDebugDomain="https://data.datalivemarketing.com.br/staging/inject/v7",this.dlid="",this.start=!1,this.divStyle="position:fixed;\n            top: 50px;\n            left: calc(50% - 250px);\n            z-index:999999;\n            width: 500px;\n            height: 130px;\n            background: #FFF;\n            display: flex;\n            flex-direction: column;\n            justify-content: center;\n            align-items: center;\n            border-radius: 8px;\n            box-shadow: 0 2px 5px 1px rgba(0,0,0,.5);\n            color: #8C3CFC;\n            font-weight: 500;",this.dlid=e,this.initEasterEggListenerDLID()}return e.prototype.initEasterEggListenerDLID=function(){var e=this,t=0,n=[77,65,73,79,77,75,73,68];document.addEventListener("keydown",function(o){if((t=o.shiftKey&&o.keyCode==n[t]?t+1:0)==n.length){var a=e.createAlertDLID(e.dlid);document.body.appendChild(a),t=0,setTimeout(function(){for(var e=document.querySelectorAll("#dl-id-info"),t=0;t<e.length;t++)e[t]&&e[t].remove()},1e4)}})},e.prototype.createAlertDLID=function(e){var t=document.createElement("div"),n='\n            <div style="'.concat(this.divStyle,'" id="dl-id-info">\n                <span> O SEU ID É: </span>\n                <span> ').concat(e,' </span>\n                <span> <input type="button" onClick="EasterEggDL.submitFormCopiar(\'').concat(e,'\')" value="Copy"></span>\n            </div>\n        ');return t.innerHTML=n,t},e.submitFormCopiar=function(e){var t=document.createElement("input");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy")},e}(),EventsDataLayer=function(){function e(){}return e.event=function(e,t,n,o){var a=new SocketEvents;a.eventCategory=t,a.eventLabel=n,a.eventValue=o,a.eventAction=TranslateEvents.action(e),dataLayer.push({event:"DL_EVENT_SOCKET",data:a})},e}(),IndexDB=function(){function e(){}return e.prototype.connect=function(){this.connection=window.indexedDB.open("Datalive",1),this.events()},e.test=function(){if("object"!=typeof window.indexedDB)throw"Recurso não existente."},e.prototype.events=function(){this.connection.onerror=function(){},this.connection.onsuccess=function(){},this.connection.onupgradeneeded=function(e){var t=e.target.result.createObjectStore("HTML",{keyPath:"template"});t.createIndex("template","template",{unique:!0}),t.createIndex("version","version",{unique:!1}),t.createIndex("html","html",{unique:!1}),t.createIndex("templateChild","templateChild",{unique:!1}),t.createIndex("unidadeNegocio","unidadeNegocio",{unique:!1})}},e.prototype.getTemplate=function(e,t){var n=window.indexedDB.open("Datalive",1);n.onsuccess=function(){var o=n.result.transaction(["HTML"],"readwrite").objectStore("HTML").get(parseInt(e));o.onerror=function(){},o.onsuccess=function(){var e=o.result;e&&t(e)}}},e.prototype.getTemplates=function(e){var t=window.indexedDB.open("Datalive",1);t.onsuccess=function(){var n=t.result.transaction(["HTML"],"readwrite").objectStore("HTML").getAll();n.onerror=function(){e(null)},n.onsuccess=function(){var t=n.result;t&&e(t)}}},e.prototype.setTemplate=function(e){var t=this;window.indexedDB.open("Datalive",1).onsuccess=function(){for(var n=[],o=0;o<e.length;o++){var a=""+e[o].idTemplate;null!=e[o].name&&(a=e[o].name);var i={template:e[o].idTemplate,unidadeNegocio:e[o].idUnidadeNegocio,name:a,version:e[o].version,html:e[o].html,templateChild:e[o].idCustomTemplateChild};n.push(i)}for(o=0;o<n.length;o++)t.putHTML(n[o].template,n[o],function(e){t.add(e)})}},e.prototype.putHTML=function(e,t,n){var o=window.indexedDB.open("Datalive",1);o.onsuccess=function(){var a=o.result.transaction(["HTML"],"readwrite").objectStore("HTML"),i=a.get(e);i.onerror=function(){n(t)},i.onsuccess=function(){var e=i.result;if(e){e.version=t.version,e.html=t.html;var o=""+t.template;null!=t.name&&(o=t.name),e.name=o,a.put(e)}else n(t)}}},e.prototype.add=function(e){var t=window.indexedDB.open("Datalive",1);t.onsuccess=function(){t.result.transaction(["HTML"],"readwrite").objectStore("HTML").add(e)}},e}(),IndexTemplate=function(){function e(){}return e.setTemplate=function(e){for(var t=0;t<e.length;t++){var n=""+e[t].idTemplate;null!=e[t].name&&(n=e[t].name);var o=new TemplateDB;o.template=e[t].idTemplate,o.name=n,o.unidadeNegocio=e[t].idUnidadeNegocio,o.version=e[t].version,o.html=e[t].html,o.templateChild=e[t].idCustomTemplateChild,this.UpdateListaTemplate(o)}},e.getTemplate=function(e,t){var n=this.templates.findIndex(function(t){return t.template==e.template});-1!=n&&t(this.templates[n].html)},e.UpdateListaTemplate=function(e){var t=this.templates.findIndex(function(t){return t.template==e.template});-1==t?this.templates.push(e):(this.templates[t].template=e.template,this.templates[t].name=e.name,this.templates[t].unidadeNegocio=e.unidadeNegocio,this.templates[t].version=e.version,this.templates[t].html=e.html,this.templates[t].templateChild=e.templateChild)},e.templates=[],e}(),Interpolation=function(){function e(e){this.variables=e.Variable,this.idShow=e.IdShow}return e.prototype.convert=function(e){for(var t in this.variables)"IdTemplate"!=t&&(e=e.replace(new RegExp("{{".concat(t,"}}"),"gi"),this.variables[t]));return e},e.prototype.getPersonalizacao=function(e){void 0===e&&(e={});var t={};for(var n in t.IdShow=this.idShow,this.variables)"p_"===n.toLowerCase().substring(0,2)&&(t[n]=this.variables[n]);for(var n in e)t[n]=e[n];return JSON.stringify(t)},e}(),Mask=function(){function e(){}return e.prototype.addEventTel=function(e){e.addEventListener("keyup",function(){var t="".concat(e.value);t=(t=t.replace(/[A-z]*/g,"")).replace(/^([0-9]{2})([0-9])/g,"($1) $2"),e.value=t})},e}(),Socket=function(){function e(e,t){this.attemptsTemp=0,this.attempts=0,this.attempts=t,this.attemptsTemp=t,this.connect(e)}return e.prototype.connect=function(e){var t=this;if(this.attemptsTemp>0){this.attemptsTemp--;try{this.socket=new WebSocket(e)}catch(e){EventsDataLayer.event("connect","websocket","AdBlock",e.message)}this.socket.onerror=function(n){EventsDataLayer.event("connect","websocket","FailReconnection",n.data),console.warn("Reconectando.",t.attemptsTemp),t.connect(e)},this.socket.onclose=function(n){console.warn("Reconectando.",t.attemptsTemp),t.connect(e)},this.socket.onopen=function(){var e=new RequestPageView;e.dlId=Controls.DL_ID,e.idUnidadeNegocio=DL_ID_UNIDADE_NEGOCIO,e.url=location.href;var n=JSON.stringify(e);t.sendMessage(n,"USER"),t.db=new IndexDB,t.db.connect(),t.db.getTemplates(function(t){if(e.templates=[],null!=t)for(var n=0,o=t;n<o.length;n++){var a=o[n],i=new Template;i.idTemplate=a.template,i.version=a.version,e.templates.push(i)}TemplateControl.getTemplatesAPI(Controls.getAPIUrl(),e,function(e){try{var t=new IndexDB;IndexDB.test(),t.connect(),t.setTemplate(e)}catch(t){IndexTemplate.setTemplate(e)}})})},this.socket.onmessage=function(e){var t=JSON.parse(e.data);if(""!==t.Message)switch(t.Method){case"TEMPLATE":var n=JSON.parse(t.Message);try{var o=new IndexDB;IndexDB.test(),o.connect(),o.setTemplate(n)}catch(e){IndexTemplate.setTemplate(n)}break;case"EVENT":var a=JSON.parse(t.Message);new Recommendation(a);break;case"NON-CONSENT":var i=JSON.parse(t.Message);i.IdUnidadeNegocio==DL_ID_UNIDADE_NEGOCIO&&new NonConsent(i)}}}},e.prototype.sendMessage=function(e,t){var n=new SocketComunication;n.Method=t,n.Message=e;var o=JSON.stringify(n);this.socket.send(o)},e}(),TemplateControl=function(){function e(){}return e.get=function(e,t){try{var n=new IndexDB;IndexDB.test(),n.connect(),n.getTemplate(e,function(e){t(e.html)})}catch(n){IndexTemplate.getTemplate(e,function(e){t(e.html)})}},e.getChild=function(e,t){try{var n=new IndexDB;IndexDB.test(),n.connect(),n.getTemplate(e,function(e){t(e.templateChild)})}catch(n){IndexTemplate.getTemplate(e,function(e){t(e.templateChild)})}},e.getTemplatesAPI=function(e,t,n){var o=JSON.stringify(t),a=new Headers;a.append("Content-Type","application/json"),a.append("Accept","application/json"),a.append("Connection","close"),fetch(e,{method:"POST",mode:"cors",headers:a,body:o}).then(function(e){return e.text()}).then(function(e){return n(JSON.parse(e).data)}).catch(function(e){return console.log("error",e)})},e}(),TranslateEvents=function(){function e(){}return e.type=function(e){switch(e){case 1:return"Popup";case 2:return"DataLayer";default:return e}},e.trigger=function(e){switch(e){case 1:return"Exit";case 2:return"Time";default:return e}},e.action=function(e){switch(e){case 1:return"Show";case 2:return"Closed";case 3:return"Converted";case 4:return"Quarentena";case 5:return"Blocked";case 6:return"ControlCampaign";case 7:return"BlockedByBlackLit";case 8:return"BlockedByWhiteLit";case 9:return"Received";default:return e}},e}(),Controls=function(){function e(){}return e.setTimePageview=function(){localStorage.setItem("DL_PAGEVIEW","".concat((new Date).getTime())),this.getTimePageview()},e.getTimePageview=function(){this.TIME_PAGEVIEW=+localStorage.getItem("DL_PAGEVIEW")},e.setOpen=function(){sessionStorage.setItem("dl_open","1")},e.getOpen=function(){return sessionStorage.getItem("dl_open")?1:0},e.removeOpen=function(){sessionStorage.removeItem("dl_open")},e.setSessionExit=function(){sessionStorage.setItem("dl_exit","1")},e.getSessionExit=function(){return sessionStorage.getItem("dl_exit")?1:0},e.setQuarentine=function(e){var t=(new Date).getTime();sessionStorage.setItem("dl_last",t+e),this.removeQuarentine()},e.getQuarentine=function(){return sessionStorage.getItem("dl_last")?1:0},e.removeQuarentine=function(){var e=(new Date).getTime(),t=+sessionStorage.getItem("dl_last");setTimeout(function(){sessionStorage.removeItem("dl_last")},t-e>0?t-e:1)},e.setSocketUrl=function(e){sessionStorage.setItem("dl_urlSocket",e)},e.getSocketUrl=function(){return sessionStorage.getItem("dl_urlSocket")},e.setAPIUrl=function(e){sessionStorage.setItem("dl_urlAPI",e)},e.getAPIUrl=function(){return sessionStorage.getItem("dl_urlAPI")},e.setAgree=function(){localStorage.setItem("dl_agree","1")},e.getAgree=function(){return localStorage.getItem("dl_agree")},e}(),RequestPageView=function(){return function(){}}(),Template=function(){return function(){}}(),TemplateDB=function(){return function(){}}(),ResponseNonConsent=function(){return function(){}}(),ResponseServer=function(){return function(){}}(),Param=function(){return function(){this.Quarentine=6e4}}(),SocketComunication=function(){return function(){}}(),SocketEvents=function(){return function(){}}();!function(e){e[e.SHOW=1]="SHOW",e[e.CLOSED=2]="CLOSED",e[e.CONVERTED=3]="CONVERTED",e[e.QUARENTENA=4]="QUARENTENA",e[e.BLOCKED=5]="BLOCKED",e[e.CONTROL_CAMPAIGN=6]="CONTROL_CAMPAIGN",e[e.BLOCKED_BY_BLACKLIST=7]="BLOCKED_BY_BLACKLIST",e[e.BLOCKED_BY_WHITELIST=8]="BLOCKED_BY_WHITELIST",e[e.RECEIVED=9]="RECEIVED",e[e.ERROR=10]="ERROR"}(EventAction||(EventAction={}));